{% extends "controller/base.html" %}

{% block title %}Timelapse Gallery{% endblock %}

{% block actions %}
<div class="player-controls">
  <div class="action-group">
    <button id="play-pause" class="btn-action">
      <!-- show/hide these via JS depending on state -->
      <i class="fas fa-play" aria-hidden="true"></i>
      <i class="fas fa-pause" aria-hidden="true" style="display:none;"></i>
    </button>
    <label for="speed-number">Speed (ms/frame):</label>
  </div>
  <div class="action-group">
    <input id="speed-number" type="number" min="25" value="500" class="input-field speed-input" />
    <input id="speed-slider" type="range" min="25" max="2000" step="50" value="500" class="speed-slider" />
  </div>

  <button id="open-tl-settings" class="btn-action">
    <i class="fas fa-cog" aria-hidden="true"></i>
  </button>

  <form method="post" action="{% url 'download_timelapse' %}" id="download-tl-form" style="display:inline;">
    {% csrf_token %}
    <input type="hidden" name="speed_ms" id="download-speed" value="{{ timelapse_speed_ms }}">
    <button type="submit" class="btn-action">
      <i class="fas fa-download" aria-hidden="true"></i>
    </button>
  </form>
</div>
{% endblock %}


{% block content %}
<div class="timelapse-container">

  <!-- Viewer Card -->
  <section class="card timelapse-viewer">
    <div class="player">
      <canvas id="timelapse-canvas"></canvas>
      <div id="frame-timestamp" class="frame-timestamp"></div>
    </div>
  </section>

</div>


<!-- Timelapse Settings Modal -->
<div id="timelapse-settings-modal" class="modal" aria-hidden="true">
  <div class="modal-wrapper">
    <div class="modal-header">
      <button class="modal-close" id="close-tl-settings">&times;</button>
      <h2 class="card-title">Timelapse Settings</h2>
    </div>
    <div class="modal-content">
      <form method="post" class="settings-grid">
        {% csrf_token %}
        {% for field in form.visible_fields %}
        <div class="setting-row">
          <div class="form-group">
            {{ field.label_tag }}
            {{ field }}
          </div>
          <div class="form-group">
            {% if field.help_text %}<small class="muted">{{ field.help_text }}</small>{% endif %}
            {% for err in field.errors %}<div class="error">{{ err }}</div>{% endfor %}
          </div>
        </div>
        {% endfor %}
        <div class="setting-row form-actions">
          <div class="form-group">
            <button type="submit" class="btn-action">Save Settings</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="modal-backdrop"></div>
</div>
{% endblock %}

{% block navigation %}
<div class="app-navigation timelapse-navigation">

  <div class="thumbnail-container">
    <!-- Nav buttons must live INSIDE the scrolling .thumbnails -->
    <div class="thumbnails">
      {% for url in images reversed %}
        <img
          class="thumb"
          data-index="{{ forloop.counter0 }}"
          data-src="{{ url }}"
          src="{{ url }}?{{ forloop.counter0 }}"
          alt="Frame {{ forloop.counter }}"
        />
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}


{% block scripts %}
<script>
  controller.initMediaBrowser();
</script>
{% endblock %}
