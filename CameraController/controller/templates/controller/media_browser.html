{% extends "controller/base.html" %}
{% load static %}

{% block title %}Media Browser{% endblock %}

{% block navigation %}
<div class="card navigation-card span-2">
  <div class="navigation-grid tabs" role="tablist">
    <button class="tab active" data-target="photos">Photos</button>
    <button class="tab" data-target="videos">Videos</button>
    <button class="tab" data-target="timelapse">Timelapse</button>
  </div>
</div>
{% endblock %}

{% block actions %}
{# PHOTOS #}
<section id="photosActions" class="tab-content active">
  <div class="actions-card">
    <div class="layout-controls">
      <button id="photos-grid" class="btn-action active"><i class="fas fa-th-large"></i></button>
      <button id="photos-list" class="btn-action"><i class="fas fa-list"></i></button>
    </div>
    <div class="batch-controls">
      <button id="photos-select-all" class="btn-action"><i class="fas fa-check-square"></i> Select All</button>
      <button id="photos-unselect-all" class="btn-action"><i class="fas fa-square"></i> Unselect All</button>
    </div>
    <div class="spacer"></div>
    <button id="photos-delete-selected" class="btn-action disabled"><i class="fas fa-trash"></i> Delete Selected</button>
    <form id="photos-download-selected-form" method="post" action="{% url 'download_selected_photos' %}">
      {% csrf_token %}
      <div class="selected-inputs"></div>
      <button id="photos-download-selected" type="button" class="btn-action disabled"><i class="fas fa-download"></i> Download Selected</button>
    </form>
    <form method="post" action="{% url 'download_all_photos' %}">
      {% csrf_token %}
      <button class="btn-action"><i class="fas fa-download"></i> Download All</button>
    </form>
    <button id="photos-delete-all" class="btn-action"><i class="fas fa-trash-alt"></i> Delete All</button>
  </div>
</section>

{# VIDEOS #}
<section id="videosActions" class="tab-content" hidden>
  <div class="actions-card">
    <div class="layout-controls">
      <button id="videos-grid" class="btn-action active"><i class="fas fa-th-large"></i></button>
      <button id="videos-list" class="btn-action"><i class="fas fa-list"></i></button>
    </div>
    <div class="batch-controls">
      <button id="videos-select-all" class="btn-action"><i class="fas fa-check-square"></i> Select All</button>
      <button id="videos-unselect-all" class="btn-action"><i class="fas fa-square"></i> Unselect All</button>
    </div>
    <div class="spacer"></div>
    <button id="videos-delete-selected" class="btn-action disabled"><i class="fas fa-trash"></i> Delete Selected</button>
    <form id="videos-download-selected-form" method="post" action="{% url 'download_selected_videos' %}">
      {% csrf_token %}
      <div class="selected-inputs"></div>
      <button id="videos-download-selected" type="button" class="btn-action disabled"><i class="fas fa-download"></i> Download Selected</button>
    </form>
    <form method="post" action="{% url 'download_all_videos' %}">
      {% csrf_token %}
      <button class="btn-action"><i class="fas fa-download"></i> Download All</button>
    </form>
    <button id="videos-delete-all" class="btn-action"><i class="fas fa-trash-alt"></i> Delete All</button>
  </div>
</section>

{# TIMELAPSE #}
<section id="timelapseActions" class="tab-content" hidden>
  <div class="actions-card">
    <div class="layout-controls">
      <button id="tl-grid" class="btn-action active"><i class="fas fa-th-large"></i></button>
      <button id="tl-list" class="btn-action"><i class="fas fa-list"></i></button>
    </div>
    <div class="batch-controls">
      <button id="tl-select-all" class="btn-action"><i class="fas fa-check-square"></i> Select All</button>
      <button id="tl-unselect-all" class="btn-action"><i class="fas fa-square"></i> Unselect All</button>
    </div>
    <div class="spacer"></div>
    <button id="tl-delete-selected" class="btn-action disabled"><i class="fas fa-trash"></i> Delete Selected</button>
    <form id="tl-download-selected-form" method="post" action="{% url 'download_selected_timelapse' %}">
      {% csrf_token %}
      <div class="selected-inputs"></div>
      <button id="tl-download-selected" type="button" class="btn-action disabled"><i class="fas fa-download"></i> Download Selected</button>
    </form>
    <form method="post" action="{% url 'download_all_timelapse' %}">
      {% csrf_token %}
      <button class="btn-action"><i class="fas fa-download"></i> Download All</button>
    </form>
    <button id="tl-delete-all" class="btn-action"><i class="fas fa-trash-alt"></i> Delete All</button>
  </div>
</section>
{% endblock %}

{% block content %}
<div class="media-container">

  {# PHOTOS #}
  <section id="photos" class="tab-content active">
    <div id="photos-gallery" class="gallery grid-view">
      {% for photo in photos %}
      <div class="gallery-item" data-filename="{{ photo.filename }}">
        <input type="checkbox" class="select-item">
        <img src="{{ photo.url }}" alt="{{ photo.filename }}">
        <div class="item-controls">
          <button class="btn-action preview-item" data-url="{{ photo.url }}"><i class="fas fa-eye"></i></button>
          <a href="{{ photo.url }}" download class="btn-action"><i class="fas fa-download"></i></a>
          <button class="btn-action delete-item" data-url="{% url 'api_delete_photo' filename=photo.filename %}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>
      </div>
      {% empty %}
      <p class="muted">No photos available.</p>
      {% endfor %}
    </div>
  </section>

  {# VIDEOS #}
  <section id="videos" class="tab-content" hidden>
    <div id="videos-gallery" class="gallery grid-view">
      {% for video in videos %}
      <div class="gallery-item" data-filename="{{ video.filename }}">
        <input type="checkbox" class="select-item">
        <video muted>
          <source src="{{ video.url }}" type="video/mp4">
        </video>
        <div class="item-controls">
          <button class="btn-action preview-item" data-url="{{ video.url }}"><i class="fas fa-eye"></i></button>
          <a href="{{ video.url }}" download class="btn-action"><i class="fas fa-download"></i></a>
          <button class="btn-action delete-item" data-url="{% url 'api_delete_video' filename=video.filename %}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>
      </div>
      {% empty %}
      <p class="muted">No videos available.</p>
      {% endfor %}
    </div>
  </section>

  {# TIMELAPSE #}
  <section id="timelapse" class="tab-content" hidden>
    <div id="tl-gallery" class="gallery grid-view">
      {% for tl in timelapses %}
      <div class="gallery-item" data-filename="{{ tl.filename }}">
        <input type="checkbox" class="select-item">
        <img src="{{ tl.url }}" alt="{{ tl.filename }}">
        <div class="item-controls">
          <button class="btn-action preview-item" data-url="{{ tl.url }}"><i class="fas fa-eye"></i></button>
          <a href="{{ tl.url }}" download class="btn-action"><i class="fas fa-download"></i></a>
          <button class="btn-action delete-item" data-url="{% url 'api_delete_timelapse' filename=tl.filename %}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>
      </div>
      {% empty %}
      <p class="muted">No timelapse frames available.</p>
      {% endfor %}
    </div>
  </section>

</div>

<!-- Preview Modal -->
<div id="preview-modal" class="modal">
  <div class="modal-content">
    <span id="preview-close" class="modal-close">&times;</span>
    <img id="preview-img" style="display:none;" alt="Preview">
    <video id="preview-video" controls style="display:none;"></video>
  </div>
</div>
{% endblock %}
